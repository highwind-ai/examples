# Overview:

The training folder utilizes KFP's [Containerized Python Components](https://www.kubeflow.org/docs/components/pipelines/user-guides/components/containerized-python-components/) and contains the following scripts for this example:

- `data_prep`: Responsible for loading the data, renaming columns, handling data type conversions, dealing with missing values, and updating specific columns.

- `feature_engineering`: Handles encoding categorical features, scaling features, and preparing the data for modeling.

-  `model_training`: Conducts training of a KNN model on PCA-transformed training data.

- `pipeline.py`: Manages KFP pipeline construction logic.

## Usage:

**STEP 1: Environment set up**
 - Set up your environment with the required dependencies - **If you have not already done so**

 - Run the following commands
    - **NB:** Ensure you are in the root directory before running the commands

    ```shell
    # Use Python 3.9/3.11

    # Initial setup

    python -m venv .train && source .train/bin/activate
    pip install -r training/train-requirements.txt

    # Activate after setup (run every time)

    source .train/bin/activate
    ```

**STEP 2:  Build the KFP image component**
 - Within the `pipeline.py` script, look for `@dsl.component`, below `base_image`, you will be required to add a `target_image` prior to building the KFP component.

      - The target image will be the `Image_URI` generated on Highwind when you create an Asset (See section below for steps on how to get the image URI).

      - Example: `target_image="example_image:v1"`

 - Once you have the `Image_URI`, update and save the `pipeline.py` script.

 - Proceed to run the following command:
    - **NB:** Ensure you are within the `training` folder

    ```shell
      kfp component build ./ --component-filepattern pipeline.py --no-push-image
    ```

 - Once done, you should now see additional files and folders get generated by KFP:
    - component_metadata folder with a yaml file
    - kfp_config.ini file
    - .dockerignore file
    - Dockerfile
    - runtime-requirements text file

    - **NB:** Every time you want to run the kfp component build command, you are required to delete the files generated by KFP. Unfortunately, KFP does not overwrite these files when executing the mentioned command, hence the file deletion is required.

**STEP 3: Compile the pipeline**
- Navigate within the `training` folder to compile the pipeline script by running the following:

    ```shell
    python -m pipeline
    ```

  - An IR YAML file will be generated.

  - This file will be uploaded to Highwind (Highwind Pipeline is currently under development).


## Obtain the Target Image: Highwind Asset and Use Case Creation

  - Refer to the  [Highwind User Manual](https://docs.highwind.ai/zindi/deploy/) for detailed instructions on creating an asset and use case.

  - After creating the `Docker repo Asset`, a pop-up will display the Docker Image Push Commands. Follow these steps to obtain the `Image_URI`